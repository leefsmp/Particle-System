#include "ParticleEmitter.h"
#include <stdlib.h> 
#include <math.h>

///////////////////////////////////////////////////////////////////
// constructor
//
///////////////////////////////////////////////////////////////////
ParticleEmitter::ParticleEmitter(int id): BaseObject(id, 0) {

}

///////////////////////////////////////////////////////////////////
//
//
///////////////////////////////////////////////////////////////////
void ParticleEmitter::setEmissionRate(double emissionRate) {

	_emissionRate = emissionRate;
}

double ParticleEmitter::getEmissionRate () {

	return _emissionRate;
}

///////////////////////////////////////////////////////////////////
//
//
///////////////////////////////////////////////////////////////////
void ParticleEmitter::setVelocity (double velocity) {

	_velocity = velocity;
}

double ParticleEmitter::getVelocity () {

	return _velocity;
}

///////////////////////////////////////////////////////////////////
//
//
///////////////////////////////////////////////////////////////////
void ParticleEmitter::setSpread(double spread) {

	_spread = spread;
}

double ParticleEmitter::getSpread () {

	return _spread;
}

///////////////////////////////////////////////////////////////////
//
//
///////////////////////////////////////////////////////////////////
void ParticleEmitter::setCharge(double charge) {

	_charge = charge;
}

double ParticleEmitter::getCharge () {

	return _charge;
}

///////////////////////////////////////////////////////////////////
// constructor
//
///////////////////////////////////////////////////////////////////
int ParticleEmitter::emitNumber(double dt) {

	return floor(_emissionRate * dt);
}

///////////////////////////////////////////////////////////////////
//
//
///////////////////////////////////////////////////////////////////
double ParticleEmitter::random() {

	return ((double) rand() / (RAND_MAX)); 
}

///////////////////////////////////////////////////////////////////
//
//
///////////////////////////////////////////////////////////////////
void ParticleEmitter::emitParticle(Particle* pParticle) {

	double angle1 = _spread * (2 * random() - 1);
    double angle2 = _spread * (2 * random() - 1);

    pParticle->getVelocity()->set(
		_velocity * cos(angle1) * cos(angle2),
		_velocity * sin(angle1) * cos(angle2),
		_velocity * sin(angle2));

    pParticle->getPosition()->set(_position);
	
    pParticle->setCharge(_charge);
}
